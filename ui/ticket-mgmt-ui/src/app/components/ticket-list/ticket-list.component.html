<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">Ticket Management</h1>
        <p class="page-subtitle">View and manage all your support tickets</p>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" stroke="currentColor" stroke-width="1.5"/>
              <path d="M20.59 22C20.59 18.13 16.74 15 12 15C7.26 15 3.41 18.13 3.41 22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="user-details">
            <span class="user-greeting">Welcome,</span>
            <span class="user-name">{{ username }}</span>
            <span *ngIf="isAdmin" class="role-badge admin-badge">ADMIN</span>
            <span *ngIf="!isAdmin" class="role-badge general-badge">GENERAL</span>
          </div>
        </div>
        <button (click)="logout()" class="btn btn-danger btn-sm logout-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Logout
        </button>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <nav class="dashboard-nav">
      <a routerLink="/tickets" routerLinkActive="active" class="nav-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Add Ticket
      </a>
      <a routerLink="/tickets/list" routerLinkActive="active" class="nav-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        View Tickets
      </a>
    </nav>

    <div *ngIf="tickets.length === 0" class="content-card">
      <div class="empty-state">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h3>No Tickets Found</h3>
        <p>Create your first ticket to get started with ticket management</p>
        <a routerLink="/tickets" class="btn btn-primary" style="margin-top: 16px;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Create First Ticket
        </a>
      </div>
    </div>

    <div *ngIf="tickets.length > 0" class="content-card">
      <div class="table-header">
        <h2 class="table-title">All Tickets ({{ tickets.length }})</h2>
      </div>
      <div class="table-wrapper">
        <table class="professional-table">
          <thead>
  <tr>
    <th>ID</th>
    <th>Title</th>
    <th>Description</th>
    <th>Document</th>
    <th>AI Summary</th>
    <th>Created By</th>
    <th>Assigned To</th>
    <th>Created At</th>
    <th>Actions</th>
  </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ticket of tickets" [class.editing-row]="editingTicketId === ticket.id">
              <td class="ticket-id">{{ ticket.id }}</td>
              <td>
                <span *ngIf="editingTicketId !== ticket.id" class="ticket-title">{{ ticket.title }}</span>
                <input 
                  *ngIf="editingTicketId === ticket.id" 
                  type="text" 
                  [(ngModel)]="editedTicket.title" 
                  class="form-input inline-edit" />
              </td>
              <td>
                <span *ngIf="editingTicketId !== ticket.id" class="ticket-description">{{ ticket.description }}</span>
                <textarea 
                  *ngIf="editingTicketId === ticket.id" 
                  [(ngModel)]="editedTicket.description" 
                  rows="3"
                  class="form-input inline-edit"></textarea>
              </td>
              <td>
                <div *ngIf="ticket.documentName" class="document-info">
                  <div class="document-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="document-name">{{ ticket.documentName }}</span>
                  </div>
                </div>
                <span *ngIf="!ticket.documentName" class="no-document">No document</span>
              </td>
              <td>
                <div *ngIf="ticket.documentSummary" class="summary-container">
                  <div class="summary-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="summary-text">{{ ticket.documentSummary }}</span>
                  </div>
                </div>
                <span *ngIf="!ticket.documentSummary" class="no-summary">No summary</span>
              </td>
              <td>
                <div *ngIf="ticket.createdBy" class="user-badge">
                  <span class="user-name-text">{{ ticket.createdBy.username }}</span>
                </div>
                <span *ngIf="!ticket.createdBy" class="no-user">-</span>
              </td>
              <td>
                <div *ngIf="assigningTicketId === ticket.id" class="assign-container">
                  <select [(ngModel)]="selectedUserId" class="form-select assign-select">
                    <option [value]="null">Unassigned</option>
                    <option *ngFor="let user of users" [value]="user.id">{{ user.username }}</option>
                  </select>
                  <div class="assign-actions">
                    <button (click)="assignTicket()" class="btn btn-primary btn-xs"
                    *ngIf="authService.hasPermission('TICKET_ASSIGN')">Assign</button>
                    <button (click)="cancelAssign()" class="btn btn-secondary btn-xs">Cancel</button>
                  </div>
                </div>
                <div *ngIf="assigningTicketId !== ticket.id">
                  <div *ngIf="ticket.assignedTo" class="user-badge assigned">
                    <span class="user-name-text">{{ ticket.assignedTo.username }}</span>
                  </div>
                  <span *ngIf="!ticket.assignedTo" class="no-user">Unassigned</span>
                  <button 
                    *ngIf="isAdmin && assigningTicketId !== ticket.id" 
                    (click)="startAssign(ticket)" 
                    class="btn btn-info btn-xs assign-btn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Assign
                  </button>
                </div>
              </td>
              <td class="ticket-date">{{ ticket.createdAt | date:'short' }}</td>
              <td>
                <div *ngIf="editingTicketId !== ticket.id && assigningTicketId !== ticket.id" class="action-buttons">
                  <button 
                    (click)="startEdit(ticket)" 
                    class="btn btn-success btn-sm action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                      <path d="M18.5 2.50023C18.8978 2.10243 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.10243 21.5 2.50023C21.8978 2.89804 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.10243 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Edit
                  </button>
                  <button 
                    (click)="deleteTicket(ticket.id!)" 
                    class="btn btn-danger btn-sm action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Delete
                  </button>
                </div>
                <div *ngIf="editingTicketId === ticket.id" class="action-buttons">
                  <button 
                    (click)="updateTicket()" 
                    class="btn btn-primary btn-sm action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Save
                  </button>
                  <button 
                    (click)="cancelEdit()" 
                    class="btn btn-secondary btn-sm action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Cancel
                  </button>
                </div>
              </td>
  </tr>
          </tbody>
</table>
      </div>
    </div>
  </div>
</div>
